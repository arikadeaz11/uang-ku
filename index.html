<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinDeazVindi Pro - Cloud Sync</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        .gradient-header { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); }
    </style>
</head>
<body>

<div id="app" class="max-w-md mx-auto min-h-screen pb-20">
    <div class="gradient-header p-8 rounded-b-[40px] text-white text-center shadow-2xl relative">
        <div class="absolute top-4 right-6 text-[10px] bg-white/20 px-2 py-1 rounded-full border border-white/30">
            Cloud Sync Active
        </div>
        <p class="text-indigo-100 text-sm font-semibold opacity-90">Total Saldo Saya</p>
        <h1 id="balance" class="text-3xl font-extrabold mt-1 tracking-tight">Rp 0</h1>
        
        <div class="flex gap-4 mt-6">
            <div class="bg-white/20 backdrop-blur-md p-3 rounded-2xl flex-1 border border-white/10">
                <p class="text-[10px] uppercase font-black text-indigo-100">Pemasukan</p>
                <p id="total-income" class="text-sm font-bold text-emerald-300">Rp 0</p>
            </div>
            <div class="bg-white/20 backdrop-blur-md p-3 rounded-2xl flex-1 border border-white/10">
                <p class="text-[10px] uppercase font-black text-indigo-100">Pengeluaran</p>
                <p id="total-expense" class="text-sm font-bold text-rose-300">Rp 0</p>
            </div>
        </div>
    </div>

    <div class="px-6 -mt-8">
        <div class="bg-white p-6 rounded-3xl shadow-xl border border-gray-100">
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">Keterangan</label>
                    <input type="text" id="desc-input" placeholder="Beli apa? (cth: Bakso)" 
                           class="w-full p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 transition border-none">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-gray-400 uppercase ml-1">Nominal</label>
                    <div class="flex gap-2">
                        <input type="text" id="amount-input" placeholder="Harga (cth: 20rb)" 
                               class="flex-1 p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-indigo-500 transition border-none">
                        <button onclick="addTransaction()" 
                                class="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 active:scale-95 transition-all shadow-lg shadow-indigo-200">
                            Simpan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="px-6 mt-8">
        <div class="flex justify-between items-center mb-4">
            <h3 class="font-black text-gray-800 tracking-tight">Riwayat Catatan</h3>
            <button onclick="clearAllData()" class="text-[10px] font-bold text-rose-500 hover:underline uppercase">Reset Lokal</button>
        </div>
        
        <div id="transaction-list" class="space-y-3">
            </div>
    </div>
</div>

<script>
    // URL GOOGLE SHEETS KAMU
    const SHEETS_URL = "https://script.google.com/macros/s/AKfycbyzIuLn5rfmDO6OMFV0KOYBM3QWd58jwjx1DEEbL_BDM96EU4D7CxCj8y2q-RpbugEt/exec";

    let transactions = JSON.parse(localStorage.getItem('vindi_pro_data')) || [];

    function formatIDR(num) {
        return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(num);
    }

    // AI SEDERHANA UNTUK KATEGORI
    function detectCategory(desc) {
        const text = desc.toLowerCase();
        if (text.includes("gaji") || text.includes("bonus") || text.includes("thr") || text.includes("laku")) 
            return { cat: "Pendapatan", type: "income", icon: "ðŸ’°" };
        
        if (text.includes("makan") || text.includes("minum") || text.includes("bakso") || text.includes("kopi") || text.includes("snack"))
            return { cat: "Konsumsi", type: "expense", icon: "ðŸ±" };
            
        if (text.includes("bensin") || text.includes("ojek") || text.includes("grab") || text.includes("gojek") || text.includes("parkir"))
            return { cat: "Transport", type: "expense", icon: "ðŸ›µ" };
            
        if (text.includes("listrik") || text.includes("pulsa") || text.includes("wifi") || text.includes("kuota") || text.includes("air"))
            return { cat: "Tagihan", type: "expense", icon: "âš¡" };

        if (text.includes("shopee") || text.includes("baju") || text.includes("skincare") || text.includes("topup"))
            return { cat: "Belanja", type: "expense", icon: "ðŸ›ï¸" };

        return { cat: "Lainnya", type: "expense", icon: "ðŸ“" };
    }

    function addTransaction() {
        const dInput = document.getElementById('desc-input');
        const aInput = document.getElementById('amount-input');
        
        if (!dInput.value || !aInput.value) { alert("Data belum lengkap!"); return; }

        // Proses Angka Pintar
        let amountText = aInput.value.toLowerCase().replace(/[^0-9a-z]/g, '');
        let amount = parseInt(amountText.replace(/[^0-9]/g, '')) || 0;
        if (amountText.includes('jt')) amount *= 1000000;
        else if (amountText.includes('rb') || amountText.includes('k')) amount *= 1000;

        // Proses AI Kategori
        const analysis = detectCategory(dInput.value);

        const newTx = {
            id: Date.now(),
            date: new Date().toLocaleString('id-ID'),
            description: dInput.value,
            amount: amount,
            category: analysis.cat,
            type: analysis.type,
            icon: analysis.icon
        };

        // Simpan Lokal
        transactions.unshift(newTx);
        localStorage.setItem('vindi_pro_data', JSON.stringify(transactions));
        render();

        // KIRIM KE GOOGLE SHEETS
        fetch(SHEETS_URL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(newTx)
        });

        dInput.value = '';
        aInput.value = '';
    }

    function deleteTransaction(id) {
        if(confirm("Hapus catatan ini secara lokal?")) {
            transactions = transactions.filter(t => t.id !== id);
            localStorage.setItem('vindi_pro_data', JSON.stringify(transactions));
            render();
        }
    }

    function clearAllData() {
        if(confirm("Hapus semua riwayat di HP? (Data di Sheets tetap aman)")) {
            transactions = [];
            localStorage.removeItem('vindi_pro_data');
            render();
        }
    }

    function render() {
        const list = document.getElementById('transaction-list');
        list.innerHTML = '';
        
        let totalInc = 0;
        let totalExp = 0;

        transactions.forEach(tx => {
            if(tx.type === 'income') totalInc += tx.amount;
            else totalExp += tx.amount;

            list.innerHTML += `
                <div class="bg-white p-4 rounded-2xl flex items-center justify-between shadow-sm border border-gray-50 group hover:border-indigo-100 transition">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 ${tx.type === 'income' ? 'bg-emerald-50 text-emerald-600' : 'bg-rose-50 text-rose-600'} rounded-xl flex items-center justify-center text-xl shadow-inner">
                            ${tx.icon}
                        </div>
                        <div>
                            <p class="font-bold text-gray-800 text-sm leading-tight">${tx.description}</p>
                            <p class="text-[10px] text-indigo-500 font-black uppercase tracking-widest mt-1">${tx.category}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-black text-sm ${tx.type === 'income' ? 'text-emerald-600' : 'text-gray-800'}">
                            ${tx.type === 'income' ? '+' : '-'}${formatIDR(tx.amount)}
                        </p>
                        <button onclick="deleteTransaction(${tx.id})" class="text-[10px] text-gray-300 hover:text-rose-500 font-bold uppercase transition">Hapus</button>
                    </div>
                </div>
            `;
        });

        if(transactions.length === 0) {
            list.innerHTML = '<div class="text-center py-10 text-gray-400 text-xs font-medium italic">Belum ada catatan hari ini...</div>';
        }

        document.getElementById('balance').innerText = formatIDR(totalInc - totalExp);
        document.getElementById('total-income').innerText = formatIDR(totalInc);
        document.getElementById('total-expense').innerText = formatIDR(totalExp);
    }

    render();
</script>

</body>
</html>
